{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.11.0rc3", "generated_at": "2025-12-17T09:16:21.441264Z", "invocation_id": "34ab04a7-101a-4b70-b950-a9e84014a2a1", "invocation_started_at": "2025-12-17T09:16:07.849291Z", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-17T09:16:12.596423Z", "completed_at": "2025-12-17T09:16:12.625314Z"}, {"name": "execute", "started_at": "2025-12-17T09:16:12.626285Z", "completed_at": "2025-12-17T09:16:14.309569Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 1.7255194187164307, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01c11b8c-0001-6deb-000c-ee7e0004e33e"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.marketing_iq.fct_ga4_sessions", "compiled": true, "compiled_code": "\n\n/*\n    GA4 Sessions Fact Table\n    Exposes total sessions (not just engaged) and session quality metrics\n    Source: GA4.TRAFFIC_ACQUISITION_SESSION_SOURCE_MEDIUM_REPORT\n*/\n\nwith session_source_medium as (\n    select\n        date as date_day,\n        property,\n        session_source,\n        session_medium,\n\n        -- Session counts (total, not just engaged!)\n        sessions as total_sessions,\n        engaged_sessions,\n\n        -- User metrics\n        total_users,\n\n        -- Engagement metrics\n        engagement_rate,\n        events_per_session,\n        user_engagement_duration,\n        event_count,\n\n        -- Conversion metrics\n        key_events,\n        total_revenue\n\n    from CLIENT_RARE_SEEDS_DB.GA4.traffic_acquisition_session_source_medium_report\n),\n\n-- Aggregate by date and source/medium\ndaily_sessions as (\n    select\n        date_day,\n        session_source,\n        session_medium,\n        concat(\n            coalesce(session_source, '(direct)'),\n            ' / ',\n            coalesce(session_medium, '(none)')\n        ) as source_medium,\n\n        -- Session totals\n        sum(total_sessions) as total_sessions,\n        sum(engaged_sessions) as engaged_sessions,\n        sum(total_users) as total_users,\n\n        -- Engagement metrics (weighted average)\n        case\n            when sum(total_sessions) > 0\n            then sum(engaged_sessions)::float / sum(total_sessions)\n            else 0\n        end as engagement_rate,\n\n        -- Average events per session (weighted)\n        case\n            when sum(total_sessions) > 0\n            then sum(events_per_session * total_sessions) / sum(total_sessions)\n            else 0\n        end as avg_events_per_session,\n\n        -- Total engagement duration\n        sum(user_engagement_duration) as total_engagement_duration,\n\n        -- Average engagement duration per session\n        case\n            when sum(total_sessions) > 0\n            then sum(user_engagement_duration) / sum(total_sessions)\n            else 0\n        end as avg_engagement_duration_per_session,\n\n        -- Event totals\n        sum(event_count) as total_events,\n        sum(key_events) as total_key_events,\n\n        -- Revenue\n        sum(total_revenue) as total_revenue\n\n    from session_source_medium\n    group by date_day, session_source, session_medium\n)\n\nselect\n    md5(cast(coalesce(cast(date_day as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(source_medium as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as ga4_session_sk,\n    'ga4' as platform,\n\n    -- Date dimensions\n    date_day,\n    date_trunc('week', date_day)::date as date_week,\n    date_trunc('month', date_day)::date as date_month,\n    extract(dow from date_day) as day_of_week,\n\n    -- Traffic source\n    session_source,\n    session_medium,\n    source_medium,\n\n    -- Session metrics (KEY: Total sessions, not just engaged!)\n    total_sessions,\n    engaged_sessions,\n    total_sessions - engaged_sessions as non_engaged_sessions,\n\n    -- User metrics\n    total_users,\n\n    -- Engagement metrics\n    round(engagement_rate * 100, 2) as engagement_rate_pct,\n    round((1 - engagement_rate) * 100, 2) as bounce_proxy_pct,  -- Proxy for bounce rate\n    round(avg_events_per_session, 2) as avg_events_per_session,\n    round(avg_engagement_duration_per_session, 2) as avg_engagement_duration_sec,\n\n    -- Engagement duration in minutes for readability\n    round(avg_engagement_duration_per_session / 60, 2) as avg_engagement_duration_min,\n\n    -- Event metrics\n    total_events,\n    total_key_events,\n\n    -- Conversion rate\n    case\n        when total_sessions > 0\n        then round(total_key_events::float / total_sessions * 100, 4)\n        else 0\n    end as key_event_rate_pct,\n\n    -- Revenue metrics\n    total_revenue,\n    case\n        when total_sessions > 0\n        then round(total_revenue / total_sessions, 2)\n        else 0\n    end as revenue_per_session,\n\n    -- Session quality score (composite metric)\n    case\n        when total_sessions > 0\n        then round(\n            (engagement_rate * 40) +  -- 40% weight on engagement\n            (least(avg_events_per_session / 10, 1) * 30) +  -- 30% weight on events (capped at 10)\n            (least(avg_engagement_duration_per_session / 300, 1) * 30),  -- 30% weight on duration (capped at 5 min)\n            2\n        )\n        else 0\n    end as session_quality_score,\n\n    -- Session quality category\n    case\n        when engagement_rate >= 0.7 and avg_events_per_session >= 5 then 'High Quality'\n        when engagement_rate >= 0.5 and avg_events_per_session >= 3 then 'Medium Quality'\n        when engagement_rate >= 0.3 then 'Low Quality'\n        else 'Very Low Quality'\n    end as session_quality_category,\n\n    -- Traffic source category\n    case\n        when lower(session_medium) in ('organic', 'seo') then 'Organic Search'\n        when lower(session_medium) in ('cpc', 'ppc', 'paid', 'paidsearch') then 'Paid Search'\n        when lower(session_medium) in ('email', 'newsletter') then 'Email'\n        when lower(session_medium) in ('social', 'social-media', 'sm') then 'Social'\n        when lower(session_medium) in ('referral', 'ref') then 'Referral'\n        when lower(session_medium) = '(none)' or session_medium is null then 'Direct'\n        when lower(session_medium) in ('display', 'banner', 'cpm') then 'Display'\n        when lower(session_medium) in ('affiliate', 'affiliates') then 'Affiliate'\n        else 'Other'\n    end as traffic_channel\n\nfrom daily_sessions\nwhere total_sessions > 0", "relation_name": "CLIENT_RARE_SEEDS_DB.PUBLIC_analytics.fct_ga4_sessions", "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-12-17T09:16:14.320573Z", "completed_at": "2025-12-17T09:16:14.324568Z"}, {"name": "execute", "started_at": "2025-12-17T09:16:14.337576Z", "completed_at": "2025-12-17T09:16:14.692316Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.3757474422454834, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01c11b8c-0001-6e0f-000c-ee7e0004cfea"}, "message": null, "failures": 0, "unique_id": "test.marketing_iq.accepted_values_fct_ga4_sessions_session_quality_category__High_Quality__Medium_Quality__Low_Quality__Very_Low_Quality.5b682edbf9", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        session_quality_category as value_field,\n        count(*) as n_records\n\n    from CLIENT_RARE_SEEDS_DB.PUBLIC_analytics.fct_ga4_sessions\n    group by session_quality_category\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'High Quality','Medium Quality','Low Quality','Very Low Quality'\n)\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-17T09:16:12.593428Z", "completed_at": "2025-12-17T09:16:12.618325Z"}, {"name": "execute", "started_at": "2025-12-17T09:16:12.619309Z", "completed_at": "2025-12-17T09:16:14.697311Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 2.11232590675354, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01c11b8c-0001-6e0f-000c-ee7e0004cfe6"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.marketing_iq.fct_keyword_competitive", "compiled": true, "compiled_code": "\n\n/*\n    Keyword Competitive Metrics Fact Table\n    Exposes impression share and competitive position metrics for Google Ads keywords\n    Source: GOOGLE_ADS.SEARCH_KEYWORD_STATS\n*/\n\nwith search_keyword_stats as (\n    select\n        date as date_day,\n        customer_id as account_id,\n        campaign_id,\n        ad_group_id,\n        ad_group_criterion_criterion_id as keyword_id,\n\n        -- Performance metrics\n        impressions,\n        clicks,\n        cost_micros / 1000000.0 as cost,\n        ctr,\n        average_cpc / 1000000.0 as avg_cpc,\n        average_cpm / 1000000.0 as avg_cpm,\n\n        -- Conversion metrics\n        conversions_value as conversion_value,\n        conversions_from_interactions_rate as conversion_rate,\n        view_through_conversions,\n\n        -- Competitive position metrics (the key new data!)\n        top_impression_percentage,\n        absolute_top_impression_percentage\n\n    from CLIENT_RARE_SEEDS_DB.GOOGLE_ADS.search_keyword_stats\n    where impressions > 0\n),\n\n-- Get keyword info from dim_keyword (using keyword_id + ad_group_id as unique key)\nkeyword_info as (\n    select\n        keyword_id,\n        ad_group_id,\n        keyword_text,\n        match_type,\n        status as keyword_status\n    from CLIENT_RARE_SEEDS_DB.PUBLIC_analytics.dim_keyword\n    where is_current = true\n),\n\n-- Get campaign info\ncampaign_info as (\n    select\n        campaign_id,\n        campaign_name,\n        status as campaign_status,\n        campaign_type\n    from CLIENT_RARE_SEEDS_DB.PUBLIC_analytics.dim_campaign\n    where platform = 'google_ads'\n    and is_current = true\n),\n\n-- Get ad group info\nad_group_info as (\n    select\n        ad_group_id,\n        ad_group_name,\n        status as ad_group_status\n    from CLIENT_RARE_SEEDS_DB.PUBLIC_analytics.dim_ad_group\n    where is_current = true\n)\n\nselect\n    md5(cast(coalesce(cast(s.date_day as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(s.keyword_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(s.ad_group_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(s.campaign_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as keyword_competitive_sk,\n    'google_ads' as platform,\n\n    -- Date dimensions\n    s.date_day,\n    date_trunc('week', s.date_day)::date as date_week,\n    date_trunc('month', s.date_day)::date as date_month,\n    extract(dow from s.date_day) as day_of_week,\n\n    -- Identifiers\n    s.account_id,\n    s.campaign_id,\n    c.campaign_name,\n    c.campaign_type,\n    s.ad_group_id,\n    ag.ad_group_name,\n    s.keyword_id,\n    k.keyword_text,\n    k.match_type,\n\n    -- Performance metrics\n    s.impressions,\n    s.clicks,\n    s.cost,\n    s.ctr,\n    s.avg_cpc,\n    s.avg_cpm,\n\n    -- Conversion metrics\n    s.conversion_value,\n    s.conversion_rate,\n    s.view_through_conversions,\n\n    -- Competitive position metrics\n    s.top_impression_percentage,\n    s.absolute_top_impression_percentage,\n\n    -- Calculated: Non-top impression percentage (appeared lower on page)\n    case\n        when s.top_impression_percentage is not null\n        then round((1 - s.top_impression_percentage) * 100, 2)\n        else null\n    end as below_top_impression_pct,\n\n    -- Calculated: Gap between top and absolute top\n    case\n        when s.top_impression_percentage is not null\n        and s.absolute_top_impression_percentage is not null\n        then round((s.top_impression_percentage - s.absolute_top_impression_percentage) * 100, 2)\n        else null\n    end as top_vs_absolute_gap_pct,\n\n    -- Position category\n    case\n        when s.absolute_top_impression_percentage >= 0.5 then 'Dominant (50%+ Absolute Top)'\n        when s.absolute_top_impression_percentage >= 0.25 then 'Strong (25-50% Absolute Top)'\n        when s.top_impression_percentage >= 0.5 then 'Competitive (50%+ Top)'\n        when s.top_impression_percentage >= 0.25 then 'Moderate (25-50% Top)'\n        when s.top_impression_percentage > 0 then 'Weak (<25% Top)'\n        else 'No Position Data'\n    end as position_category,\n\n    -- ROAS calculation\n    case\n        when s.cost > 0\n        then round(s.conversion_value / s.cost, 2)\n        else 0\n    end as roas,\n\n    -- Cost efficiency at position\n    case\n        when s.absolute_top_impression_percentage > 0 and s.cost > 0\n        then round(s.cost / (s.absolute_top_impression_percentage * 100), 4)\n        else null\n    end as cost_per_abs_top_imp_pct\n\nfrom search_keyword_stats s\nleft join keyword_info k on s.keyword_id = k.keyword_id and s.ad_group_id = k.ad_group_id\nleft join campaign_info c on s.campaign_id = c.campaign_id\nleft join ad_group_info ag on s.ad_group_id = ag.ad_group_id", "relation_name": "CLIENT_RARE_SEEDS_DB.PUBLIC_analytics.fct_keyword_competitive", "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-12-17T09:16:14.317567Z", "completed_at": "2025-12-17T09:16:14.324568Z"}, {"name": "execute", "started_at": "2025-12-17T09:16:14.325578Z", "completed_at": "2025-12-17T09:16:14.811305Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.49569249153137207, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01c11b8c-0001-6e0f-000c-ee7e0004cfee"}, "message": null, "failures": 0, "unique_id": "test.marketing_iq.accepted_values_fct_ga4_sessions_platform__ga4.3167b3014c", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        platform as value_field,\n        count(*) as n_records\n\n    from CLIENT_RARE_SEEDS_DB.PUBLIC_analytics.fct_ga4_sessions\n    group by platform\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'ga4'\n)\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-12-17T09:16:14.708129Z", "completed_at": "2025-12-17T09:16:14.716139Z"}, {"name": "execute", "started_at": "2025-12-17T09:16:14.716139Z", "completed_at": "2025-12-17T09:16:14.906479Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.20027422904968262, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01c11b8c-0001-6e0f-000c-ee7e0004cff2"}, "message": null, "failures": 0, "unique_id": "test.marketing_iq.not_null_fct_ga4_sessions_engaged_sessions.8dad512608", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect engaged_sessions\nfrom CLIENT_RARE_SEEDS_DB.PUBLIC_analytics.fct_ga4_sessions\nwhere engaged_sessions is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-12-17T09:16:14.817309Z", "completed_at": "2025-12-17T09:16:14.825150Z"}, {"name": "execute", "started_at": "2025-12-17T09:16:14.826159Z", "completed_at": "2025-12-17T09:16:15.052563Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.23724937438964844, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01c11b8c-0001-6deb-000c-ee7e0004e346"}, "message": null, "failures": 0, "unique_id": "test.marketing_iq.not_null_fct_ga4_sessions_ga4_session_sk.f3ed3cddcb", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect ga4_session_sk\nfrom CLIENT_RARE_SEEDS_DB.PUBLIC_analytics.fct_ga4_sessions\nwhere ga4_session_sk is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-12-17T09:16:14.703121Z", "completed_at": "2025-12-17T09:16:14.713128Z"}, {"name": "execute", "started_at": "2025-12-17T09:16:14.714127Z", "completed_at": "2025-12-17T09:16:15.062560Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.36224913597106934, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01c11b8c-0001-6deb-000c-ee7e0004e342"}, "message": null, "failures": 0, "unique_id": "test.marketing_iq.accepted_values_fct_ga4_sessions_traffic_channel__Organic_Search__Paid_Search__Email__Social__Referral__Direct__Display__Affiliate__Other.ed61c69e60", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        traffic_channel as value_field,\n        count(*) as n_records\n\n    from CLIENT_RARE_SEEDS_DB.PUBLIC_analytics.fct_ga4_sessions\n    group by traffic_channel\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'Organic Search','Paid Search','Email','Social','Referral','Direct','Display','Affiliate','Other'\n)\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-12-17T09:16:14.909403Z", "completed_at": "2025-12-17T09:16:14.913404Z"}, {"name": "execute", "started_at": "2025-12-17T09:16:14.913404Z", "completed_at": "2025-12-17T09:16:15.142203Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.23379945755004883, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01c11b8c-0001-6deb-000c-ee7e0004e34a"}, "message": null, "failures": 0, "unique_id": "test.marketing_iq.not_null_fct_ga4_sessions_platform.f3dba1d9ac", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect platform\nfrom CLIENT_RARE_SEEDS_DB.PUBLIC_analytics.fct_ga4_sessions\nwhere platform is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-12-17T09:16:15.063560Z", "completed_at": "2025-12-17T09:16:15.069561Z"}, {"name": "execute", "started_at": "2025-12-17T09:16:15.070560Z", "completed_at": "2025-12-17T09:16:15.241054Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.18348908424377441, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01c11b8c-0001-6e0f-000c-ee7e0004cff6"}, "message": null, "failures": 0, "unique_id": "test.marketing_iq.not_null_fct_ga4_sessions_total_sessions.20d4ab90ce", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect total_sessions\nfrom CLIENT_RARE_SEEDS_DB.PUBLIC_analytics.fct_ga4_sessions\nwhere total_sessions is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-12-17T09:16:15.075265Z", "completed_at": "2025-12-17T09:16:15.080437Z"}, {"name": "execute", "started_at": "2025-12-17T09:16:15.081441Z", "completed_at": "2025-12-17T09:16:15.290205Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.21964550018310547, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01c11b8c-0001-6e0f-000c-ee7e0004cffa"}, "message": null, "failures": 0, "unique_id": "test.marketing_iq.unique_fct_ga4_sessions_ga4_session_sk.e0f430351e", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    ga4_session_sk as unique_field,\n    count(*) as n_records\n\nfrom CLIENT_RARE_SEEDS_DB.PUBLIC_analytics.fct_ga4_sessions\nwhere ga4_session_sk is not null\ngroup by ga4_session_sk\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-12-17T09:16:15.148214Z", "completed_at": "2025-12-17T09:16:15.154204Z"}, {"name": "execute", "started_at": "2025-12-17T09:16:15.154204Z", "completed_at": "2025-12-17T09:16:15.338692Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.19249415397644043, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01c11b8c-0001-6e0f-000c-ee7e0004cffe"}, "message": null, "failures": 0, "unique_id": "test.marketing_iq.accepted_values_fct_keyword_competitive_platform__google_ads.4dd1e199c4", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        platform as value_field,\n        count(*) as n_records\n\n    from CLIENT_RARE_SEEDS_DB.PUBLIC_analytics.fct_keyword_competitive\n    group by platform\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'google_ads'\n)\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-12-17T09:16:15.248072Z", "completed_at": "2025-12-17T09:16:15.257980Z"}, {"name": "execute", "started_at": "2025-12-17T09:16:15.258980Z", "completed_at": "2025-12-17T09:16:15.485346Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.23931670188903809, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01c11b8c-0001-6e0f-000c-ee7e0004d002"}, "message": null, "failures": 0, "unique_id": "test.marketing_iq.accepted_values_fct_keyword_competitive_position_category__Dominant_50_Absolute_Top___Strong_25_50_Absolute_Top___Competitive_50_Top___Moderate_25_50_Top___Weak_25_Top___No_Position_Data.9027675b6b", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        position_category as value_field,\n        count(*) as n_records\n\n    from CLIENT_RARE_SEEDS_DB.PUBLIC_analytics.fct_keyword_competitive\n    group by position_category\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'Dominant (50%+ Absolute Top)','Strong (25-50% Absolute Top)','Competitive (50%+ Top)','Moderate (25-50% Top)','Weak (<25% Top)','No Position Data'\n)\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-12-17T09:16:15.341684Z", "completed_at": "2025-12-17T09:16:15.345684Z"}, {"name": "execute", "started_at": "2025-12-17T09:16:15.346683Z", "completed_at": "2025-12-17T09:16:15.556427Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.2157433032989502, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01c11b8c-0001-6deb-000c-ee7e0004e352"}, "message": null, "failures": 0, "unique_id": "test.marketing_iq.not_null_fct_keyword_competitive_platform.058d4c285b", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect platform\nfrom CLIENT_RARE_SEEDS_DB.PUBLIC_analytics.fct_keyword_competitive\nwhere platform is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-12-17T09:16:15.292468Z", "completed_at": "2025-12-17T09:16:15.296204Z"}, {"name": "execute", "started_at": "2025-12-17T09:16:15.297198Z", "completed_at": "2025-12-17T09:16:15.576340Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.285142183303833, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01c11b8c-0001-6deb-000c-ee7e0004e34e"}, "message": null, "failures": 0, "unique_id": "test.marketing_iq.not_null_fct_keyword_competitive_keyword_competitive_sk.c6c984a182", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect keyword_competitive_sk\nfrom CLIENT_RARE_SEEDS_DB.PUBLIC_analytics.fct_keyword_competitive\nwhere keyword_competitive_sk is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-12-17T09:16:15.487342Z", "completed_at": "2025-12-17T09:16:15.492341Z"}, {"name": "execute", "started_at": "2025-12-17T09:16:15.492341Z", "completed_at": "2025-12-17T09:16:15.778490Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.29114866256713867, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01c11b8c-0001-6deb-000c-ee7e0004e356"}, "message": null, "failures": 0, "unique_id": "test.marketing_iq.unique_fct_keyword_competitive_keyword_competitive_sk.024344b547", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    keyword_competitive_sk as unique_field,\n    count(*) as n_records\n\nfrom CLIENT_RARE_SEEDS_DB.PUBLIC_analytics.fct_keyword_competitive\nwhere keyword_competitive_sk is not null\ngroup by keyword_competitive_sk\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-17T09:16:12.586985Z", "completed_at": "2025-12-17T09:16:12.600770Z"}, {"name": "execute", "started_at": "2025-12-17T09:16:12.600770Z", "completed_at": "2025-12-17T09:16:20.474763Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 7.8917555809021, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01c11b8c-0001-6deb-000c-ee7e0004e33a"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.marketing_iq.fct_email_health", "compiled": true, "compiled_code": "\n\n/*\n    Email Health Fact Table\n    Tracks email deliverability and list health metrics from Klaviyo\n    Source: KLAVIYO.EVENT + KLAVIYO.METRIC\n*/\n\nwith email_health_metrics as (\n    select\n        id as metric_id,\n        name as metric_name\n    from CLIENT_RARE_SEEDS_DB.KLAVIYO.metric\n    where lower(name) in (\n        'bounced email',\n        'received email',\n        'unsubscribed from email marketing',\n        'unsubscribed from list',\n        'subscribed to list',\n        'subscribed to email marketing',\n        'marked email as spam',\n        'bounce suppression added',\n        'dropped email'\n    )\n),\n\nemail_health_events as (\n    select\n        e.id as event_id,\n        date(e.datetime) as event_date,\n        m.metric_name,\n        e.person_id,\n        -- Categorize events\n        case\n            when lower(m.metric_name) = 'bounced email' then 'bounce'\n            when lower(m.metric_name) = 'bounce suppression added' then 'bounce_suppression'\n            when lower(m.metric_name) = 'dropped email' then 'dropped'\n            when lower(m.metric_name) = 'received email' then 'delivered'\n            when lower(m.metric_name) in ('unsubscribed from email marketing', 'unsubscribed from list') then 'unsubscribe'\n            when lower(m.metric_name) in ('subscribed to list', 'subscribed to email marketing') then 'subscribe'\n            when lower(m.metric_name) = 'marked email as spam' then 'spam'\n            else 'other'\n        end as event_category\n    from CLIENT_RARE_SEEDS_DB.KLAVIYO.event e\n    inner join email_health_metrics m on e.metric_id = m.metric_id\n),\n\n-- Daily aggregation\ndaily_email_health as (\n    select\n        event_date as date_day,\n\n        -- Delivery metrics\n        count(case when event_category = 'delivered' then 1 end) as emails_delivered,\n        count(case when event_category = 'bounce' then 1 end) as emails_bounced,\n        count(case when event_category = 'bounce_suppression' then 1 end) as bounce_suppressions,\n        count(case when event_category = 'dropped' then 1 end) as emails_dropped,\n\n        -- Unique bounced profiles\n        count(distinct case when event_category = 'bounce' then person_id end) as unique_bounced_profiles,\n\n        -- List health metrics\n        count(case when event_category = 'unsubscribe' then 1 end) as unsubscribes,\n        count(case when event_category = 'subscribe' then 1 end) as new_subscribers,\n\n        -- Unique unsubscribed profiles\n        count(distinct case when event_category = 'unsubscribe' then person_id end) as unique_unsubscribed_profiles,\n        count(distinct case when event_category = 'subscribe' then person_id end) as unique_new_subscribers,\n\n        -- Spam complaints\n        count(case when event_category = 'spam' then 1 end) as spam_complaints,\n        count(distinct case when event_category = 'spam' then person_id end) as unique_spam_complainers\n\n    from email_health_events\n    group by event_date\n)\n\nselect\n    md5(cast(coalesce(cast(date_day as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as email_health_sk,\n    'klaviyo' as platform,\n\n    -- Date dimensions\n    date_day,\n    date_trunc('week', date_day)::date as date_week,\n    date_trunc('month', date_day)::date as date_month,\n    extract(dow from date_day) as day_of_week,\n\n    -- Delivery metrics\n    emails_delivered,\n    emails_bounced,\n    bounce_suppressions,\n    emails_dropped,\n    unique_bounced_profiles,\n\n    -- Bounce rate\n    case\n        when emails_delivered > 0\n        then round(emails_bounced::float / (emails_delivered + emails_bounced) * 100, 4)\n        else 0\n    end as bounce_rate_pct,\n\n    -- List health metrics\n    unsubscribes,\n    new_subscribers,\n    unique_unsubscribed_profiles,\n    unique_new_subscribers,\n\n    -- Net subscriber growth\n    new_subscribers - unsubscribes as net_subscriber_change,\n    unique_new_subscribers - unique_unsubscribed_profiles as net_unique_subscriber_change,\n\n    -- Unsubscribe rate (per delivered)\n    case\n        when emails_delivered > 0\n        then round(unsubscribes::float / emails_delivered * 100, 4)\n        else 0\n    end as unsubscribe_rate_pct,\n\n    -- Spam complaints\n    spam_complaints,\n    unique_spam_complainers,\n\n    -- Spam complaint rate\n    case\n        when emails_delivered > 0\n        then round(spam_complaints::float / emails_delivered * 100, 6)\n        else 0\n    end as spam_rate_pct,\n\n    -- List health score (0-100, higher is better)\n    -- Penalizes: bounces, unsubscribes, spam\n    -- Rewards: new subscribers, low bounce rate\n    case\n        when emails_delivered > 0\n        then greatest(0, least(100,\n            100\n            - (case when emails_delivered > 0 then emails_bounced::float / (emails_delivered + emails_bounced) * 100 * 2 else 0 end)  -- Bounce penalty (2x weight)\n            - (case when emails_delivered > 0 then unsubscribes::float / emails_delivered * 100 * 1.5 else 0 end)  -- Unsubscribe penalty (1.5x weight)\n            - (case when emails_delivered > 0 then spam_complaints::float / emails_delivered * 100 * 10 else 0 end)  -- Spam penalty (10x weight)\n            + (case when unsubscribes > 0 then least(new_subscribers::float / unsubscribes * 5, 10) else 10 end)  -- Subscriber growth bonus (max 10 points)\n        ))\n        else 100\n    end as list_health_score,\n\n    -- Health category\n    case\n        when emails_delivered = 0 then 'No Activity'\n        when emails_bounced::float / nullif(emails_delivered + emails_bounced, 0) >= 0.05 then 'Critical (5%+ Bounce)'\n        when emails_bounced::float / nullif(emails_delivered + emails_bounced, 0) >= 0.02 then 'Warning (2-5% Bounce)'\n        when spam_complaints > 0 and spam_complaints::float / nullif(emails_delivered, 0) >= 0.001 then 'Spam Alert (>0.1%)'\n        when unsubscribes > new_subscribers then 'List Shrinking'\n        else 'Healthy'\n    end as health_category,\n\n    -- Deliverability score (focused on technical delivery)\n    case\n        when emails_delivered + emails_bounced + emails_dropped > 0\n        then round(\n            emails_delivered::float / (emails_delivered + emails_bounced + emails_dropped) * 100,\n            2\n        )\n        else 100\n    end as deliverability_score\n\nfrom daily_email_health\nwhere date_day is not null\norder by date_day desc", "relation_name": "CLIENT_RARE_SEEDS_DB.PUBLIC_analytics.fct_email_health", "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-12-17T09:16:20.492874Z", "completed_at": "2025-12-17T09:16:20.501434Z"}, {"name": "execute", "started_at": "2025-12-17T09:16:20.506441Z", "completed_at": "2025-12-17T09:16:20.668854Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.1870894432067871, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01c11b8c-0001-6e0f-000c-ee7e0004f006"}, "message": null, "failures": 0, "unique_id": "test.marketing_iq.not_null_fct_email_health_email_health_sk.fef7e0dcf3", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect email_health_sk\nfrom CLIENT_RARE_SEEDS_DB.PUBLIC_analytics.fct_email_health\nwhere email_health_sk is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-12-17T09:16:20.496358Z", "completed_at": "2025-12-17T09:16:20.501434Z"}, {"name": "execute", "started_at": "2025-12-17T09:16:20.504441Z", "completed_at": "2025-12-17T09:16:20.681852Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.2000880241394043, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01c11b8c-0001-6deb-000c-ee7e0004e362"}, "message": null, "failures": 0, "unique_id": "test.marketing_iq.not_null_fct_email_health_emails_bounced.2ed69c93c9", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect emails_bounced\nfrom CLIENT_RARE_SEEDS_DB.PUBLIC_analytics.fct_email_health\nwhere emails_bounced is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-12-17T09:16:20.489882Z", "completed_at": "2025-12-17T09:16:20.505440Z"}, {"name": "execute", "started_at": "2025-12-17T09:16:20.508444Z", "completed_at": "2025-12-17T09:16:20.694852Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.2130880355834961, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01c11b8c-0001-6deb-000c-ee7e0004e35e"}, "message": null, "failures": 0, "unique_id": "test.marketing_iq.accepted_values_fct_email_health_platform__klaviyo.9fc845a219", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        platform as value_field,\n        count(*) as n_records\n\n    from CLIENT_RARE_SEEDS_DB.PUBLIC_analytics.fct_email_health\n    group by platform\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'klaviyo'\n)\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-12-17T09:16:20.485764Z", "completed_at": "2025-12-17T09:16:20.501434Z"}, {"name": "execute", "started_at": "2025-12-17T09:16:20.502442Z", "completed_at": "2025-12-17T09:16:20.723855Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.24309206008911133, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01c11b8c-0001-6deb-000c-ee7e0004e35a"}, "message": null, "failures": 0, "unique_id": "test.marketing_iq.accepted_values_fct_email_health_health_category__No_Activity__Critical_5_Bounce___Warning_2_5_Bounce___Spam_Alert_0_1___List_Shrinking__Healthy.e569b406fc", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        health_category as value_field,\n        count(*) as n_records\n\n    from CLIENT_RARE_SEEDS_DB.PUBLIC_analytics.fct_email_health\n    group by health_category\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'No Activity','Critical (5%+ Bounce)','Warning (2-5% Bounce)','Spam Alert (>0.1%)','List Shrinking','Healthy'\n)\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-12-17T09:16:20.687852Z", "completed_at": "2025-12-17T09:16:20.695852Z"}, {"name": "execute", "started_at": "2025-12-17T09:16:20.697853Z", "completed_at": "2025-12-17T09:16:20.817672Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.13081979751586914, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01c11b8c-0001-6e0f-000c-ee7e0004f00e"}, "message": null, "failures": 0, "unique_id": "test.marketing_iq.not_null_fct_email_health_platform.34c42dbeff", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect platform\nfrom CLIENT_RARE_SEEDS_DB.PUBLIC_analytics.fct_email_health\nwhere platform is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-12-17T09:16:20.673870Z", "completed_at": "2025-12-17T09:16:20.682852Z"}, {"name": "execute", "started_at": "2025-12-17T09:16:20.683852Z", "completed_at": "2025-12-17T09:16:20.820689Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.14783406257629395, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01c11b8c-0001-6deb-000c-ee7e0004e366"}, "message": null, "failures": 0, "unique_id": "test.marketing_iq.not_null_fct_email_health_emails_delivered.55a924cb9e", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect emails_delivered\nfrom CLIENT_RARE_SEEDS_DB.PUBLIC_analytics.fct_email_health\nwhere emails_delivered is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-12-17T09:16:20.701853Z", "completed_at": "2025-12-17T09:16:20.706852Z"}, {"name": "execute", "started_at": "2025-12-17T09:16:20.706852Z", "completed_at": "2025-12-17T09:16:20.865048Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.16419506072998047, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01c11b8c-0001-6e0f-000c-ee7e0004f00a"}, "message": null, "failures": 0, "unique_id": "test.marketing_iq.unique_fct_email_health_email_health_sk.e76916d34f", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    email_health_sk as unique_field,\n    count(*) as n_records\n\nfrom CLIENT_RARE_SEEDS_DB.PUBLIC_analytics.fct_email_health\nwhere email_health_sk is not null\ngroup by email_health_sk\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}], "elapsed_time": 10.16954755783081, "args": {"resource_types": [], "static_parser": true, "populate_cache": true, "export_saved_queries": false, "use_colors_file": true, "use_fast_test_edges": false, "vars": {}, "log_file_max_bytes": 10485760, "source_freshness_run_project_hooks": true, "validate_macro_args": false, "partial_parse_file_diff": true, "log_level_file": "debug", "which": "build", "require_explicit_package_overrides_for_builtin_materializations": true, "require_resource_names_without_spaces": true, "print": true, "quiet": false, "version_check": true, "defer": false, "require_yaml_configuration_for_mf_time_spines": false, "show_resource_report": false, "use_colors": true, "invocation_command": "dbt build --select fct_keyword_competitive fct_ga4_sessions fct_email_health --no-partial-parse", "show": false, "state_modified_compare_vars": false, "warn_error_options": {"error": [], "warn": [], "silence": []}, "partial_parse": false, "exclude": [], "log_format_file": "debug", "introspect": true, "log_path": "C:\\Users\\Akshay kumar\\Desktop\\Marketing-IQ\\dbt\\logs", "cache_selected_only": false, "require_batched_execution_for_custom_microbatch_strategy": false, "skip_nodes_if_on_run_start_fails": false, "show_all_deprecations": false, "write_json": true, "state_modified_compare_more_unrendered_values": false, "require_generic_test_arguments_property": true, "printer_width": 80, "upload_to_artifacts_ingest_api": false, "require_unique_project_resource_names": false, "require_nested_cumulative_type_params": false, "favor_state": false, "macro_debugging": false, "require_all_warnings_handled_by_warn_error": false, "indirect_selection": "eager", "profiles_dir": "C:\\Users\\Akshay kumar\\Desktop\\Marketing-IQ\\dbt", "log_format": "default", "log_level": "info", "include_saved_query": false, "empty": false, "exclude_resource_types": [], "select": ["fct_keyword_competitive", "fct_ga4_sessions", "fct_email_health"], "strict_mode": false, "send_anonymous_usage_stats": true, "project_dir": "C:\\Users\\Akshay kumar\\Desktop\\Marketing-IQ\\dbt"}}